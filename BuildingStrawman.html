

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Building Strawman &mdash; Strawman 0.1.0 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="Strawman 0.1.0 documentation" href="index.html"/>
        <link rel="up" title="Strawman Documentation" href="Strawman.html"/>
        <link rel="next" title="Strawman API" href="StrawmanAPI.html"/>
        <link rel="prev" title="Example Integrations" href="ExampleIntegrations.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Strawman
          

          
          </a>

          
            
            
              <div class="version">
                0.1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="Strawman.html">Strawman Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Overview.html">Strawman Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="ExampleIntegrations.html">Example Integrations</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Building Strawman</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#build-dependencies">Build Dependencies</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#strawman">Strawman</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#getting-started">Getting Started</a></li>
<li class="toctree-l3"><a class="reference internal" href="#build-options">Build Options</a></li>
<li class="toctree-l3"><a class="reference internal" href="#host-config-files">Host Config Files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#bootstrapping-third-party-dependencies">Bootstrapping Third Party Dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="#compiler-settings-for-third-party-dependencies">Compiler Settings for Third Party Dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="#building-with-spack">Building with Spack</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-strawman-in-another-project">Using Strawman in Another Project</a></li>
<li class="toctree-l3"><a class="reference internal" href="#building-strawman-in-a-docker-container">Building Strawman in a Docker Container</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="StrawmanAPI.html">Strawman API</a></li>
<li class="toctree-l2"><a class="reference internal" href="Actions/index.html">Strawman Actions</a></li>
<li class="toctree-l2"><a class="reference internal" href="GPU_notes.html">Strawman GPU Notes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Releases.html">Releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="Publications.html">Publications and Presentations</a></li>
<li class="toctree-l1"><a class="reference internal" href="Licenses.html">License Info</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Strawman</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
          <li><a href="Strawman.html">Strawman Documentation</a> &raquo;</li>
      
    <li>Building Strawman</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/BuildingStrawman.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="building-strawman">
<h1>Building Strawman<a class="headerlink" href="#building-strawman" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>Strawman uses CMake for its build system.
Building Strawman creates two separate libraries:</p>
<blockquote>
<div><ul class="simple">
<li>libstrawman : a version for execution on a single node</li>
<li>libstrawman_par : a version for distributed memory parallel</li>
</ul>
</div></blockquote>
<p>The CMake variable( ENABLE_MPI ON | OFF ) controls the building the parallel version of Strawman and included proxy-apps.</p>
<p>The build dependencies vary according to which pipelines and proxy-applications are desired.
For a minimal build with no parallel components, the following are required:</p>
<blockquote>
<div><ul class="simple">
<li>Conduit</li>
<li>VTK-m<ul>
<li>Boost</li>
</ul>
</li>
<li>C++ and Fortran compilers</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="build-dependencies">
<h2>Build Dependencies<a class="headerlink" href="#build-dependencies" title="Permalink to this headline">¶</a></h2>
<div class="section" id="strawman">
<h3>Strawman<a class="headerlink" href="#strawman" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ul class="simple">
<li>Conduit</li>
<li>IceT</li>
<li>One or more pipelines</li>
</ul>
</div></blockquote>
<div class="section" id="conduit">
<h4>Conduit<a class="headerlink" href="#conduit" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><ul class="simple">
<li>MPI</li>
<li>Python + NumPy (Optional)</li>
<li>HDF5 (Optional)</li>
<li>Fortran compiler (Optional)</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="icet">
<h4>IceT<a class="headerlink" href="#icet" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>IceT is only needed for the parallel version of Strawman.</p>
<ul class="simple">
<li>MPI</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="pipelines">
<h4>Pipelines<a class="headerlink" href="#pipelines" title="Permalink to this headline">¶</a></h4>
<ul>
<li><p class="first">EAVL:</p>
<blockquote>
<div><ul class="simple">
<li>OSMesa (7.5.2) is used for rendering data set annotations and is required</li>
<li>OpenMP 3.5+</li>
<li>CUDA 6.5 + (Optional)</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">VTK-m:</p>
<blockquote>
<div><ul class="simple">
<li>Boost</li>
<li>TBB (Optional)  Intel&#8217;s Threaded Building Blocks</li>
<li>CUDA 6.5+ (Optional)</li>
</ul>
</div></blockquote>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When building Stawman with VTK-m 1.0 and CUDA, nvcc becomes confused and emits warnings about calling host functions from device functions. When combined with template meta-programming, this can emit quite a large amount of text during compilation. These warning messages have been suppressed in later versions of VTK-m.</p>
</div>
<ul>
<li><p class="first">HDF5</p>
<blockquote>
<div><ul class="simple">
<li>Conduit with conduit_relay HDF5 support.</li>
</ul>
</div></blockquote>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Strawman uses VTK-m 1.0 which must be configured with rendering on, among other options.
For a full list of options that need to be set, consult <cite>/uberenv_libs/spack/var/spack/repos/builtin/packages/vtkm/package.py</cite>.
If you plan to use CUDA, a patch must be applied to VTK-m to prevent a compile error.
Using the build script will apply this patch automatically, but if compiling manually, the patch must be applied.
The patch can be found in the source repo at <cite>/uberenv_libs/spack/var/spack/repos/builtin/packages/vtkm/vtkm_patch.patch</cite></p>
</div>
</div>
</div>
</div>
<div class="section" id="getting-started">
<h2>Getting Started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h2>
<p>Clone the Straman repo:</p>
<ul class="simple">
<li>From Github</li>
</ul>
<div class="code bash highlight-default"><div class="highlight"><pre><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">llnl</span><span class="o">/</span><span class="n">strawman</span><span class="o">.</span><span class="n">git</span>
</pre></div>
</div>
<ul class="simple">
<li>From LLNL&#8217;s CZ Stash Instance (LLNL Users)</li>
</ul>
<div class="code bash highlight-default"><div class="highlight"><pre><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="p">{</span><span class="n">USER_NAME</span><span class="p">}</span><span class="nd">@lc</span><span class="o">.</span><span class="n">llnl</span><span class="o">.</span><span class="n">gov</span><span class="o">/</span><span class="n">stash</span><span class="o">/</span><span class="n">scm</span><span class="o">/</span><span class="n">vis</span><span class="o">/</span><span class="n">strawman</span><span class="o">.</span><span class="n">git</span>
</pre></div>
</div>
<p>Configure a build:</p>
<p><code class="docutils literal"><span class="pre">config-build.sh</span></code> is a simple wrapper for the cmake call to configure strawman.
This creates a new out-of-source build directory <code class="docutils literal"><span class="pre">build-debug</span></code> and a directory for the install <code class="docutils literal"><span class="pre">install-debug</span></code>.
It optionally includes a <code class="docutils literal"><span class="pre">host-config.cmake</span></code> file with detailed configuration options.</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span class="n">cd</span> <span class="n">strawman</span>
<span class="o">./</span><span class="n">config</span><span class="o">-</span><span class="n">build</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
<p>Build, test, and install Strawman:</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span class="n">cd</span> <span class="n">build</span><span class="o">-</span><span class="n">debug</span>
<span class="n">make</span> <span class="o">-</span><span class="n">j</span> <span class="mi">8</span>
<span class="n">make</span> <span class="n">test</span>
<span class="n">make</span> <span class="n">install</span>
</pre></div>
</div>
</div>
<div class="section" id="build-options">
<h2>Build Options<a class="headerlink" href="#build-options" title="Permalink to this headline">¶</a></h2>
<p>Straman&#8217;s build system supports the following CMake options:</p>
<ul class="simple">
<li><strong>BUILD_SHARED_LIBS</strong> - Controls if shared (ON) or static (OFF) libraries are built. <em>(default = ON)</em></li>
<li><strong>ENABLE_TESTS</strong> - Controls if unit tests are built. <em>(default = ON)</em></li>
<li><strong>ENABLE_DOCS</strong> - Controls if the Strawman documentation is built (when sphinx and doxygen are found ). <em>(default = ON)</em></li>
<li><strong>ENABLE_FORTRAN</strong> - Controls if Fortran components of Strawman are built. This includes the Fortran language bindings and Cloverleaf3D . <em>(default = ON)</em></li>
<li><strong>ENABLE_PYTHON</strong> - Controls if the strawman python module and related tests are built. <em>(default = OFF)</em></li>
</ul>
<blockquote>
<div>The Strawman python module will build for both Python 2 and Python 3. To select a specific Python, set the CMake variable PYTHON_EXECUTABLE to path of the desired python binary. The strawman python module requires the Conduit python module.</div></blockquote>
<ul class="simple">
<li><strong>ENABLE_OPENMP</strong> - Controls if EAVL and proxy-apps are configured with OpenMP. <em>(default = OFF)</em></li>
<li><strong>ENABLE_CUDA</strong> - Controls if VTK-m and EAVL are configured with GPU support. <em>(default = OFF)</em></li>
<li><strong>ENABLE_MPI</strong> - Controls if parallel versions of proxy-apps and Strawman are built. <em>(default = ON)</em></li>
</ul>
<blockquote>
<div><p>We are using CMake&#8217;s standard FindMPI logic. To select a specific MPI set the CMake variables <strong>MPI_C_COMPILER</strong> and <strong>MPI_CXX_COMPILER</strong>, or the other FindMPI options for MPI include paths and MPI libraries.</p>
<p>To run the mpi unit tests on LLNL&#8217;s LC platforms, you may also need change the CMake variables <strong>MPIEXEC</strong> and <strong>MPIEXEC_NUMPROC_FLAG</strong>, so you can use srun and select a partition. (for an example see: src/host-configs/chaos_5_x86_64.cmake)</p>
</div></blockquote>
<ul class="simple">
<li><strong>CONDUIT_DIR</strong> - Path to an Conduit install <em>(required for parallel version)</em>.</li>
<li><strong>ICET_DIR</strong> - Path to an ICET install <em>(required for parallel version)</em>.</li>
<li><strong>EAVL_DIR</strong> - Path to an EAVL install <em>(optional)</em>.</li>
<li><strong>VTKM_DIR</strong> - Path to an VTK-m install <em>(optional)</em>.</li>
<li><strong>OSMESA_DIR</strong> - Path to an VTK-m install <em>(required for EAVL)</em>.</li>
<li><strong>HDF5_DIR</strong> - Path to a HDF5 install <em>(optional)</em>.</li>
</ul>
</div>
<div class="section" id="host-config-files">
<h2>Host Config Files<a class="headerlink" href="#host-config-files" title="Permalink to this headline">¶</a></h2>
<p>To handle build options, third party library paths, etc we rely on CMake&#8217;s initial-cache file mechanism.</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span class="n">cmake</span> <span class="o">-</span><span class="n">C</span> <span class="n">config_file</span><span class="o">.</span><span class="n">cmake</span>
</pre></div>
</div>
<p>We call these initial-cache files <em>host-config</em> files, since we typically create a file for each platform or specific hosts if necessary.</p>
<p>The <code class="docutils literal"><span class="pre">config-build.sh</span></code> script uses your machine&#8217;s hostname, the SYS_TYPE environment variable, and your platform name (via <em>uname</em>) to look for an existing host config file in the <code class="docutils literal"><span class="pre">host-configs</span></code> directory at the root of the strawman repo. If found, it passes the host config file to CMake via the <cite>-C</cite> command line option.</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span class="n">cmake</span> <span class="p">{</span><span class="n">other</span> <span class="n">options</span><span class="p">}</span> <span class="o">-</span><span class="n">C</span> <span class="n">host</span><span class="o">-</span><span class="n">configs</span><span class="o">/</span><span class="p">{</span><span class="n">config_file</span><span class="p">}</span><span class="o">.</span><span class="n">cmake</span> <span class="o">../</span>
</pre></div>
</div>
<p>You can find example files in the <code class="docutils literal"><span class="pre">host-configs</span></code> directory.</p>
<p>These files use standard CMake commands. CMake <em>set</em> commands need to specify the root cache path as follows:</p>
<div class="code cmake highlight-default"><div class="highlight"><pre><span class="nb">set</span><span class="p">(</span><span class="n">CMAKE_VARIABLE_NAME</span> <span class="p">{</span><span class="n">VALUE</span><span class="p">}</span> <span class="n">CACHE</span> <span class="n">PATH</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>It is  possible to create your own configure file, and an boilerplate example is provided in <cite>/host-configs/boilerplate.cmake</cite></p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">If compiling all of the dependencies yourself, it is important that you use the same compilers for all dependencies. For
example, different MPI and Fortran compilers (e.g., Intel and GCC) are not compatible with one another.</p>
</div>
</div>
<div class="section" id="bootstrapping-third-party-dependencies">
<h2>Bootstrapping Third Party Dependencies<a class="headerlink" href="#bootstrapping-third-party-dependencies" title="Permalink to this headline">¶</a></h2>
<p>You can use <code class="docutils literal"><span class="pre">bootstrap-env.sh</span></code> (located at the root of the strawman repo) to help setup your development environment on OSX and Linux.
This script uses <code class="docutils literal"><span class="pre">scripts/uberenv/uberenv.py</span></code>, which leverages <strong>Spack</strong> (<a class="reference external" href="http://software.llnl.gov/spack">http://software.llnl.gov/spack</a>) to build the external third party libraries and tools used by Strawman.
Fortran support in is optional, dependencies should build without fortran.
After building these libraries and tools, it writes an initial <em>host-config</em> file and adds the Spack built CMake binary to your PATH, so can immediately call the <code class="docutils literal"><span class="pre">config-build.sh</span></code> helper script to configure a strawman build.</p>
<div class="code bash highlight-default"><div class="highlight"><pre>#build third party libs using spack
source bootstrap-env.sh

#copy the generated host-config file into the standard location
cp uberenv_libs/`hostname`*.cmake to host-configs/

# run the configure helper script
./config-build.sh

# or you can run the configure helper script and give it the
# path to a host-config file
./config-build.sh uberenv_libs/`hostname`*.cmake
</pre></div>
</div>
</div>
<div class="section" id="compiler-settings-for-third-party-dependencies">
<h2>Compiler Settings for Third Party Dependencies<a class="headerlink" href="#compiler-settings-for-third-party-dependencies" title="Permalink to this headline">¶</a></h2>
<p>You can edit <code class="docutils literal"><span class="pre">scripts/uberenv/compilers.yaml</span></code> to change the compiler settings
passed to Spack. See the <a class="reference external" href="http://software.llnl.gov/spack/basic_usage.html#manual-compiler-configuration">Spack Compiler Configuration</a>
documentation for details.</p>
<p>For OSX, the defaults in <code class="docutils literal"><span class="pre">compilers.yaml</span></code> are clang from X-Code and gfortran from <a class="reference external" href="https://gcc.gnu.org/wiki/GFortranBinaries#MacOS">https://gcc.gnu.org/wiki/GFortranBinaries#MacOS</a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The bootstrapping process ignores <code class="docutils literal"><span class="pre">~/.spack/compilers.yaml</span></code> to avoid conflicts
and surprises from a user&#8217;s specific Spack settings on HPC platforms.</p>
</div>
</div>
<div class="section" id="building-with-spack">
<h2>Building with Spack<a class="headerlink" href="#building-with-spack" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Strawman developers use <code class="docutils literal"><span class="pre">scripts/uberenv/uberenv.py</span></code> to setup third party libraries for Strawman
development.  Due to this, the process builds more libraries than necessary for most use cases.
For example, we build independent installs of Python 2 and Python 3 to make it easy
to check Python C-API compatibility during development. In the near future, we plan to
provide a Spack package to simplify deployment.</p>
</div>
</div>
<div class="section" id="using-strawman-in-another-project">
<h2>Using Strawman in Another Project<a class="headerlink" href="#using-strawman-in-another-project" title="Permalink to this headline">¶</a></h2>
<p>Under <code class="docutils literal"><span class="pre">src/examples</span></code> there are examples demonstrating how to use Strawman in a CMake-based build system (<code class="docutils literal"><span class="pre">using-with-cmake</span></code>) and via a Makefile (<code class="docutils literal"><span class="pre">using-with-make</span></code>). Under <code class="docutils literal"><span class="pre">src/examples/proxies</span></code>  you can find example integrations using strawman in the Lulesh, Kripke, and Cloverleaf3D proxy-applications.</p>
</div>
<div class="section" id="building-strawman-in-a-docker-container">
<h2>Building Strawman in a Docker Container<a class="headerlink" href="#building-strawman-in-a-docker-container" title="Permalink to this headline">¶</a></h2>
<p>Under <code class="docutils literal"><span class="pre">src/examples/docker/master/ubuntu</span></code> there is an example <code class="docutils literal"><span class="pre">Dockerfile</span></code> which can be used to create an ubuntu-based docker image with a build of the Strawman github master branch. There is also a script that demonstrates how to build a Docker image from the Dockerfile (<code class="docutils literal"><span class="pre">example_build.sh</span></code>) and a script that runs this image in a Docker container (<code class="docutils literal"><span class="pre">example_run.sh</span></code>). The Strawman repo is cloned into the image&#8217;s file system at <code class="docutils literal"><span class="pre">/strawman</span></code>, the build directory is <code class="docutils literal"><span class="pre">/strawman/build-debug</span></code>, and the install directory is <code class="docutils literal"><span class="pre">/strawman/install-debug</span></code>.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="StrawmanAPI.html" class="btn btn-neutral float-right" title="Strawman API" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="ExampleIntegrations.html" class="btn btn-neutral" title="Example Integrations" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015-2016, LLNS.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>